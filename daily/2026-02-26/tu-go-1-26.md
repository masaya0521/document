# Go 1.26 — Green Tea GC と SIMD サポート

- **日付**: 2026-02-11
- **カテゴリ**: Language
- **ソース**: [Go Blog](https://go.dev/blog/go1.26), [Go 1.26 Release Notes](https://go.dev/doc/go1.26)

## 概要

Go 1.26 は Go 1.25 から 6 ヶ月後のリリースで、言語仕様の変更、ランタイムの大幅な改善、新しい標準ライブラリパッケージの追加を含む。特に Green Tea ガベージコレクタのデフォルト化、実験的な SIMD サポート、`go fix` コマンドの全面刷新が大きなハイライトとなっている。

## 主な変更点

### 言語の変更

#### `new` 関数での初期値指定

組み込み関数 `new` がオペランドとして式を受け取れるようになり、ポインタの初期化が簡潔になった:

```go
// Go 1.25 以前
x := int64(300)
ptr := &x

// Go 1.26
ptr := new(int64(300))
```

#### ジェネリック型の自己参照

ジェネリック型が自身の型パラメータリスト内で自己参照可能になり、再帰的なデータ構造の実装が簡素化される:

```go
// 複雑な再帰的データ構造がシンプルに定義可能に
type Tree[T comparable] struct {
    Value    T
    Children []*Tree[T]
}
```

### ランタイムの改善

#### Green Tea ガベージコレクタ

実験的フェーズを経てデフォルト有効化。小オブジェクトのマーキングとスキャンのパフォーマンスが 10〜40% 改善される。

#### cgo オーバーヘッドの削減

ベースラインの cgo オーバーヘッドが約 30% 削減。C ライブラリを多用するプロジェクト（CGo バインディング、SQLite 等）で効果を実感できる。

#### スタック上のスライス割り当て

コンパイラがスライスのバッキングストアをスタック上に配置できるケースが増加し、GC 負荷の軽減とパフォーマンス向上に寄与。

#### セキュリティ強化

64 ビットプラットフォームでヒープベースアドレスがランダム化され、メモリ予測攻撃がより困難に。

### ツールの変更

#### `go fix` の全面書き直し

Go 分析フレームワークに基づいて完全に書き直され、数十の「モダナイザー」を搭載。コードを安全に最新の言語機能・ライブラリ API に移行するための提案を行う:

```bash
# コードの近代化提案を確認
go fix ./...
```

#### `go mod init` の動作変更

新規 `go.mod` ファイルはより低いバージョンの Go を指定するようになった。例えば Go 1.26 RC では `go 1.24.0` を指定する。

#### `cmd/doc` の削除

`cmd/doc` と `go tool doc` が削除され、`go doc` に一本化された。

### 新しい標準ライブラリパッケージ

| パッケージ | 概要 |
|-----------|------|
| `crypto/hpke` | RFC 9180 準拠のハイブリッド公開鍵暗号実装 |
| `crypto/mlkem/mlkemtest` | ML-KEM (ポスト量子暗号) のテストユーティリティ |
| `testing/cryptotest` | 暗号関数のテスト支援 |
| `simd/archsimd` (実験的) | アーキテクチャ固有の SIMD 操作（amd64: 128/256/512 ビットベクトル） |
| `runtime/secret` (実験的) | 秘密情報の安全な消去（amd64/arm64 Linux） |

### 既存ライブラリの改善

- **`errors.AsType`**: ジェネリック版の `As` 関数が追加
- **`reflect`**: フィールドとメソッド用の新規イテレータメソッド
- **`bytes.Buffer.Peek`**: バッファの先頭 n バイトを消費せずに参照

## 破壊的変更・移行ガイド

### 暗号関数のランダムパラメータ

DSA、ECDH、ECDSA、RSA、Ed25519 の鍵生成関数で、`rand` パラメータが無視されるようになった。テスト用には `testing/cryptotest.SetGlobalRandom` を使用する。

### TLS の動作変更

ポスト量子鍵交換（ML-KEM）がデフォルト有効化。互換性の問題がある場合は GODEBUG 設定で制御可能だが、Go 1.27 以降で削除予定。

### URL 検証の厳格化

`url.Parse` が不正なホスト名（例: `http://::1/`）を拒否するようになった。

### プラットフォームサポート

- **macOS 12**: Go 1.26 が最終サポートバージョン
- **Windows 32-bit ARM**: 削除済み

## 今後の注目点

- **Green Tea GC のさらなる最適化**: デフォルト化により広範な実環境データが収集され、次バージョンでさらなる改善が期待
- **SIMD パッケージの安定化**: 現在 amd64 のみだが、arm64 への対応拡大が見込まれる
- **`go fix` モダナイザーの拡充**: コミュニティからの追加モダナイザーの貢献が期待される
- **ポスト量子暗号のデフォルト化**: TLS での ML-KEM デフォルト有効化に伴い、エコシステム全体での対応が進む
